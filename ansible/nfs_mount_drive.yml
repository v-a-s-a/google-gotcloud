# Playbook that mounts an NFS drive on compute nodes of an Elasticluster
---

## create folder on gateway
## export it via NFS
## restart the NFS service
- hosts: gridengine_master
  tasks:
    - name: create data mount point
      sudo: yes
      file: path=/mnt/data/ state=directory owner=nobody group=nogroup
    - name: export data mount via NFS
      sudo: yes
      nfsexport: path=/mnt/data dest=/etc/exports options=rw,no_root_squash,sync
      notify:
        - restart NFS

  handlers:
    - name: restart NFS
      sudo: yes
      service: name=nfs-kernel-server state=restarted

#-hosts: gridengine_clients
#  - shell: if [ -z "$nfsoptions" ]; then  echo rw,sync,nfsvers=3; else echo $nfsoptions; fi
#    register: _nfsopts
#    sudo: false
#    connection: local
#    tags:
#      - nfs
#
#  - name: configure /etc/fstab on clients
#    action: mount name={{nfsmount}} src={{nfsserver}}:{{nfspath}} fstype=nfs opts={{_nfsopts.stdout}} state=mounted
#    tags:
#      - nfs
